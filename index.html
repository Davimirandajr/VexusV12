<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus V12 | Carbon Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Inter:wght@300;900&display=swap');
        
        body { background: #000; font-family: 'Inter', sans-serif; color: #fff; overflow: hidden; }
        .font-racing { font-family: 'Orbitron', sans-serif; }
        
        .sidebar { background: #050505; border-right: 2px solid #111; shadow: 20px 0 50px rgba(0,0,0,0.9); }
        .nav-btn { transition: 0.3s; position: relative; overflow: hidden; }
        .nav-btn.active { color: #ff0000; background: rgba(255, 0, 0, 0.05); }
        .nav-btn.active::before { content: ""; position: absolute; left: 0; top: 0; height: 100%; width: 4px; background: #ff0000; box-shadow: 0 0 15px #ff0000; }
        
        .card-car { background: linear-gradient(145deg, #0a0a0a, #111); border: 1px solid #222; transition: 0.4s; }
        .card-car:hover { border-color: #ff0000; transform: translateY(-5px); box-shadow: 0 10px 30px -10px rgba(255, 0, 0, 0.3); }
        
        .btn-v12 { background: #ff0000; transition: 0.3s; text-shadow: 0 0 5px rgba(0,0,0,0.5); }
        .btn-v12:hover { background: #cc0000; box-shadow: 0 0 20px rgba(255, 0, 0, 0.4); }

        .page { display: none; height: calc(100vh - 80px); overflow-y: auto; padding: 40px; }
        .page.active { display: block; animation: nitro 0.4s ease-out; }
        @keyframes nitro { from { opacity: 0; filter: blur(10px); transform: scale(0.95); } to { opacity: 1; filter: blur(0); transform: scale(1); } }
        
        input, select { background: #0a0a0a !important; border: 1px solid #222 !important; color: white !important; }
        input:focus { border-color: #ff0000 !important; outline: none; box-shadow: 0 0 10px rgba(255,0,0,0.2); }
    </style>
</head>
<body>

    <div class="flex h-screen">
        <aside class="w-72 sidebar flex flex-col p-6">
            <div class="mb-12">
                <h1 class="font-racing text-3xl font-black italic tracking-tighter">NEXUS<span class="text-red-600">V12</span></h1>
                <div class="h-1 w-12 bg-red-600 mt-1 shadow-[0_0_10px_#ff0000]"></div>
            </div>

            <nav class="space-y-2 flex-1">
                <button onclick="navegar('estoque')" id="btn-estoque" class="nav-btn active w-full flex items-center gap-4 p-4 text-xs font-black uppercase tracking-widest">
                    <i class="fas fa-car-side"></i> Gestão de Estoque
                </button>
                <button onclick="navegar('clientes')" id="btn-clientes" class="nav-btn w-full flex items-center gap-4 p-4 text-xs font-black uppercase tracking-widest text-zinc-500">
                    <i class="fas fa-user-friends"></i> Base de Clientes
                </button>
            </nav>

            <div class="space-y-3">
                <button onclick="abrirModal('carro')" class="w-full btn-v12 p-4 rounded-lg font-black text-[10px] uppercase tracking-tighter italic">
                    <i class="fas fa-plus-circle mr-2"></i> Adicionar Veículo
                </button>
                <button onclick="abrirModal('cliente')" class="w-full bg-zinc-900 border border-zinc-800 hover:border-zinc-600 p-4 rounded-lg font-black text-[10px] uppercase tracking-tighter italic transition">
                    <i class="fas fa-user-plus mr-2 text-red-600"></i> Adicionar Cliente
                </button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]">
            <header class="h-20 border-b border-zinc-900 flex items-center justify-between px-10 bg-black/50 backdrop-blur-md">
                <h2 id="page-title" class="font-racing text-sm uppercase tracking-[0.3em] text-zinc-500">Garagem Ativa</h2>
                <div class="w-2 h-2 bg-red-600 rounded-full animate-ping"></div>
            </header>

            <section id="page-estoque" class="page active">
                <div id="render-estoque" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
            </section>

            <section id="page-clientes" class="page">
                <div class="bg-zinc-950 border border-zinc-900 rounded-3xl overflow-hidden">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-red-600/10 text-[10px] font-black uppercase text-red-600">
                            <tr>
                                <th class="p-6">Cliente</th>
                                <th class="p-6">Telefone</th>
                                <th class="p-6">Interesse</th>
                                <th class="p-6 text-right">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="render-clientes" class="text-sm divide-y divide-zinc-900"></tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <div id="modal-carro" class="hidden fixed inset-0 bg-black/90 backdrop-blur-sm z-[100] flex items-center justify-center p-6">
        <div class="bg-zinc-950 border border-zinc-800 p-10 rounded-[40px] w-full max-w-xl shadow-2xl">
            <h2 class="font-racing text-2xl mb-8 italic text-red-600">Setup de Veículo</h2>
            <input type="hidden" id="edit-id-carro">
            <div class="grid grid-cols-2 gap-4">
                <input type="text" id="c-marca" placeholder="Marca (Ex: BMW)" class="p-4 rounded-xl col-span-2">
                <input type="text" id="c-modelo" placeholder="Modelo" class="p-4 rounded-xl col-span-2">
                <input type="number" id="c-ano" placeholder="Ano" class="p-4 rounded-xl">
                <input type="number" id="c-preco" placeholder="Preço R$" class="p-4 rounded-xl">
            </div>
            <div class="flex gap-4 mt-10">
                <button onclick="fecharModais()" class="flex-1 font-black text-zinc-600 uppercase text-xs">Abortar</button>
                <button id="save-carro" class="flex-1 btn-v12 p-4 rounded-xl font-black uppercase text-xs">Salvar na Garagem</button>
            </div>
        </div>
    </div>

    <div id="modal-cliente" class="hidden fixed inset-0 bg-black/90 backdrop-blur-sm z-[100] flex items-center justify-center p-6">
        <div class="bg-zinc-950 border border-zinc-800 p-10 rounded-[40px] w-full max-w-xl shadow-2xl">
            <h2 class="font-racing text-2xl mb-8 italic text-red-600">Cadastro de Lead</h2>
            <input type="hidden" id="edit-id-cliente">
            <div class="space-y-4">
                <input type="text" id="l-nome" placeholder="Nome Completo" class="w-full p-4 rounded-xl">
                <input type="text" id="l-fone" placeholder="WhatsApp" class="w-full p-4 rounded-xl">
                <input type="text" id="l-carro" placeholder="Veículo de Interesse" class="w-full p-4 rounded-xl">
            </div>
            <div class="flex gap-4 mt-10">
                <button onclick="fecharModais()" class="flex-1 font-black text-zinc-600 uppercase text-xs">Cancelar</button>
                <button id="save-cliente" class="flex-1 btn-v12 p-4 rounded-xl font-black uppercase text-xs">Registrar Lead</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAteL8sXETQcYQvCoSMhsK2yQy_968pTb8",
            authDomain: "crm-vexus.firebaseapp.com",
            projectId: "crm-vexus",
            storageBucket: "crm-vexus.firebasestorage.app",
            messagingSenderId: "525591438074",
            appId: "1:525591438074:web:cd006e9f0e851b5bb45f43"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // NAVEGAÇÃO
        window.navegar = (id) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('page-' + id).classList.add('active');
            document.getElementById('btn-' + id).classList.add('active');
            document.getElementById('page-title').innerText = id === 'estoque' ? 'Garagem Ativa' : 'Base de Clientes';
        };

        window.abrirModal = (tipo) => {
            fecharModais();
            document.getElementById(`modal-${tipo}`).classList.remove('hidden');
        };
        window.fecharModais = () => {
            document.getElementById('modal-carro').classList.add('hidden');
            document.getElementById('modal-cliente').classList.add('hidden');
            // Limpa IDs de edição
            document.getElementById('edit-id-carro').value = '';
            document.getElementById('edit-id-cliente').value = '';
        };

        // --- LÓGICA DE ESTOQUE ---
        document.getElementById('save-carro').onclick = async () => {
            const id = document.getElementById('edit-id-carro').value;
            const data = {
                marca: document.getElementById('c-marca').value,
                modelo: document.getElementById('c-modelo').value,
                ano: document.getElementById('c-ano').value,
                preco: parseFloat(document.getElementById('c-preco').value),
                ts: new Date().getTime()
            };

            if(id) await updateDoc(doc(db, "v12_carros", id), data);
            else await addDoc(collection(db, "v12_carros"), data);
            fecharModais();
        };

        onSnapshot(query(collection(db, "v12_carros"), orderBy("ts", "desc")), (snap) => {
            const container = document.getElementById('render-estoque');
            container.innerHTML = '';
            snap.forEach(d => {
                const c = d.data();
                container.innerHTML += `
                    <div class="card-car p-6 rounded-[32px] group relative">
                        <div class="absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition">
                            <button onclick="prepararEdicaoCarro('${d.id}', '${c.marca}', '${c.modelo}', '${c.ano}', '${c.preco}')" class="text-zinc-500 hover:text-white"><i class="fas fa-edit"></i></button>
                            <button onclick="deletarItem('v12_carros', '${d.id}')" class="text-zinc-800 hover:text-red-600"><i class="fas fa-trash"></i></button>
                        </div>
                        <p class="text-[10px] font-black text-red-600 uppercase tracking-widest mb-1">${c.marca}</p>
                        <h3 class="font-racing text-xl italic uppercase text-white">${c.modelo}</h3>
                        <p class="text-zinc-600 text-[10px] font-bold mt-1">ANO: ${c.ano}</p>
                        <div class="mt-6 pt-4 border-t border-zinc-900">
                            <span class="text-2xl font-black text-white italic">R$ ${c.preco.toLocaleString()}</span>
                        </div>
                    </div>`;
            });
        });

        window.prepararEdicaoCarro = (id, marca, modelo, ano, preco) => {
            abrirModal('carro');
            document.getElementById('edit-id-carro').value = id;
            document.getElementById('c-marca').value = marca;
            document.getElementById('c-modelo').value = modelo;
            document.getElementById('c-ano').value = ano;
            document.getElementById('c-preco').value = preco;
        };

        // --- LÓGICA DE CLIENTES ---
        document.getElementById('save-cliente').onclick = async () => {
            const id = document.getElementById('edit-id-cliente').value;
            const data = {
                nome: document.getElementById('l-nome').value,
                fone: document.getElementById('l-fone').value,
                carro: document.getElementById('l-carro').value,
                ts: new Date().getTime()
            };

            if(id) await updateDoc(doc(db, "v12_clientes", id), data);
            else await addDoc(collection(db, "v12_clientes"), data);
            fecharModais();
        };

        onSnapshot(query(collection(db, "v12_clientes"), orderBy("ts", "desc")), (snap) => {
            const container = document.getElementById('render-clientes');
            container.innerHTML = '';
            snap.forEach(d => {
                const l = d.data();
                container.innerHTML += `
                    <tr class="hover:bg-red-600/5 transition group">
                        <td class="p-6 font-bold text-white uppercase">${l.nome}</td>
                        <td class="p-6 text-zinc-500 font-mono">${l.fone}</td>
                        <td class="p-6"><span class="bg-zinc-900 px-3 py-1 rounded text-[10px] font-black text-red-600 uppercase">${l.carro}</span></td>
                        <td class="p-6 text-right space-x-3">
                            <button onclick="prepararEdicaoCliente('${d.id}', '${l.nome}', '${l.fone}', '${l.carro}')" class="text-zinc-700 hover:text-white"><i class="fas fa-edit"></i></button>
                            <button onclick="deletarItem('v12_clientes', '${d.id}')" class="text-zinc-800 hover:text-red-600"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>`;
            });
        });

        window.prepararEdicaoCliente = (id, nome, fone, carro) => {
            abrirModal('cliente');
            document.getElementById('edit-id-cliente').value = id;
            document.getElementById('l-nome').value = nome;
            document.getElementById('l-fone').value = fone;
            document.getElementById('l-carro').value = carro;
        };

        window.deletarItem = async (colecao, id) => { if(confirm("Deseja deletar este registro permanentemente?")) await deleteDoc(doc(db, colecao, id)); };
    </script>
</body>
</html>
