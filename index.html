<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus V12 | Enterprise Cloud</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background: #020617; }
        .glass { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(10px); }
        .alert-vencido { border: 2px solid #ef4444 !important; animation: pulse-red 2s infinite; }
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }
    </style>
</head>
<body class="text-slate-300">

    <div class="flex h-screen overflow-hidden">
        <aside class="w-64 bg-black border-r border-slate-800 flex flex-col p-6 shadow-2xl">
            <div class="mb-10">
                <h1 class="text-2xl font-black text-sky-400 italic italic">NEXUS V12</h1>
                <p class="text-[9px] text-slate-500 font-bold uppercase tracking-[0.3em]">Full Management</p>
            </div>

            <nav class="space-y-2 flex-1">
                <button onclick="changeTab('estoque')" id="btn-estoque" class="w-full flex items-center gap-3 p-4 rounded-xl bg-sky-600 text-white font-bold transition">
                    <i class="fas fa-box"></i> Estoque
                </button>
                <button onclick="changeTab('crm')" id="btn-crm" class="w-full flex items-center gap-3 p-4 rounded-xl hover:bg-slate-900 transition text-slate-400">
                    <i class="fas fa-users"></i> CRM / Leads
                </button>
                <button onclick="changeTab('alertas')" id="btn-alertas" class="w-full flex items-center gap-3 p-4 rounded-xl hover:bg-red-950/20 transition text-red-500">
                    <i class="fas fa-exclamation-triangle"></i> Pendências
                </button>
            </nav>

            <div class="mt-auto p-4 bg-slate-900/50 rounded-2xl border border-slate-800">
                <div class="flex justify-between text-[10px] font-bold mb-2">
                    <span class="text-slate-500">DATABASE STATUS</span>
                    <span class="text-green-500">ONLINE</span>
                </div>
                <div class="h-1 bg-slate-800 rounded-full overflow-hidden">
                    <div class="w-full h-full bg-green-500 animate-pulse"></div>
                </div>
            </div>
        </aside>

        <main class="flex-1 flex flex-col">
            <header class="p-6 bg-[#030816]/80 border-b border-slate-800 flex justify-between items-center glass">
                <div>
                    <h2 id="page-title" class="text-2xl font-black text-white italic">Estoque de Veículos</h2>
                    <p class="text-slate-500 text-xs uppercase font-bold tracking-widest" id="page-desc">Controle físico de entrada e saída</p>
                </div>
                <button onclick="openModal()" class="bg-sky-500 hover:bg-sky-400 text-white px-6 py-3 rounded-xl font-black transition flex items-center gap-2">
                    <i class="fas fa-plus"></i> NOVO REGISTRO
                </button>
            </header>

            <div class="grid grid-cols-4 gap-4 p-6 bg-slate-900/20 border-b border-slate-800">
                <div class="bg-slate-900 p-4 rounded-2xl border border-slate-800">
                    <p class="text-[10px] text-slate-500 font-bold uppercase">Total em Estoque</p>
                    <p id="stat-total" class="text-2xl font-black text-white">0</p>
                </div>
                <div class="bg-slate-900 p-4 rounded-2xl border border-slate-800">
                    <p class="text-[10px] text-slate-500 font-bold uppercase">Leads Quentes</p>
                    <p id="stat-leads" class="text-2xl font-black text-sky-400">0</p>
                </div>
                <div class="bg-slate-900 p-4 rounded-2xl border border-slate-800">
                    <p class="text-[10px] text-slate-500 font-bold uppercase">Pendências Ativas</p>
                    <p id="stat-alerts" class="text-2xl font-black text-red-500">0</p>
                </div>
                <div class="bg-slate-900 p-4 rounded-2xl border border-slate-800">
                    <p class="text-[10px] text-slate-500 font-bold uppercase">Vendas Mês</p>
                    <p id="stat-vendas" class="text-2xl font-black text-green-500">0</p>
                </div>
            </div>

            <div id="content-grid" class="p-8 overflow-y-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                </div>
        </main>
    </div>

    <div id="modal" class="hidden fixed inset-0 bg-black/95 flex items-center justify-center p-4 z-50 backdrop-blur-md">
        <div class="bg-slate-900 p-8 rounded-[32px] w-full max-w-2xl border border-slate-800 shadow-2xl">
            <h2 class="text-2xl font-black mb-6 text-sky-400 italic">Entrada de Dados Nexus</h2>
            <div class="grid grid-cols-2 gap-4">
                <div class="col-span-2 space-y-2">
                    <label class="text-[10px] font-bold text-slate-500 uppercase">Veículo / Modelo</label>
                    <input type="text" id="vModelo" placeholder="Ex: BMW M4 Competition" class="w-full p-4 bg-slate-800 rounded-xl outline-none border border-slate-700 focus:border-sky-500 transition">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-500 uppercase">Preço de Venda</label>
                    <input type="number" id="vPreco" placeholder="R$" class="w-full p-4 bg-slate-800 rounded-xl outline-none border border-slate-700">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-500 uppercase">Status do Veículo</label>
                    <select id="vStatus" class="w-full p-4 bg-slate-800 rounded-xl outline-none border border-slate-700">
                        <option value="estoque">Em Estoque (Livre)</option>
                        <option value="negociacao">Em Negociação</option>
                        <option value="vendido">Vendido / Entrega</option>
                        <option value="revisao">Oficina / Revisão</option>
                    </select>
                </div>
                <hr class="col-span-2 border-slate-800 my-2">
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-500 uppercase">Cliente (Opcional)</label>
                    <input type="text" id="cNome" placeholder="Nome do Lead" class="w-full p-4 bg-slate-800 rounded-xl outline-none border border-slate-700">
                </div>
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-500 uppercase">Prazo de Alerta (Dias)</label>
                    <input type="number" id="vPrazo" value="5" class="w-full p-4 bg-slate-800 rounded-xl outline-none border border-sky-900 text-sky-400 font-bold text-center">
                </div>
            </div>
            <div class="flex gap-4 mt-8">
                <button onclick="closeModal()" class="flex-1 text-slate-500 font-bold uppercase text-xs">Cancelar</button>
                <button id="btnSalvar" class="flex-1 bg-sky-600 p-4 rounded-2xl font-black text-white hover:bg-sky-500 transition shadow-lg shadow-sky-900/20">SALVAR REGISTRO</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // CONFIGURAÇÃO FIREBASE [Sua imagem image_1faa84.jpg]
        const firebaseConfig = {
            apiKey: "AIzaSyAteL8sXETQcYQvCoSMhsK2yQy_968pTb8",
            authDomain: "crm-vexus.firebaseapp.com",
            projectId: "crm-vexus",
            storageBucket: "crm-vexus.firebasestorage.app",
            messagingSenderId: "525591438074",
            appId: "1:525591438074:web:cd006e9f0e851b5bb45f43"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let currentTab = 'estoque';
        let allData = [];

        window.openModal = () => document.getElementById('modal').classList.remove('hidden');
        window.closeModal = () => document.getElementById('modal').classList.add('hidden');

        // SALVAR
        document.getElementById('btnSalvar').onclick = async () => {
            const dias = parseInt(document.getElementById('vPrazo').value);
            const vencimento = new Date();
            vencimento.setDate(vencimento.getDate() + dias);

            const payload = {
                carro: document.getElementById('vModelo').value,
                preco: parseFloat(document.getElementById('vPreco').value),
                status: document.getElementById('vStatus').value,
                cliente: document.getElementById('cNome').value || "Nenhum",
                dataEntrada: new Date().getTime(),
                dataVencimento: vencimento.getTime()
            };

            if(payload.carro) {
                await addDoc(collection(db, "nexus_master"), payload);
                closeModal();
            }
        };

        window.excluir = async (id) => { if(confirm("Confirmar baixa no sistema?")) await deleteDoc(doc(db, "nexus_master", id)); };

        // RENDERIZAÇÃO
        function render() {
            const grid = document.getElementById('content-grid');
            grid.innerHTML = '';
            const agora = new Date().getTime();
            
            let stats = { total: 0, leads: 0, alerts: 0, vendas: 0 };

            allData.forEach(item => {
                const isVencido = agora >= item.dataVencimento && item.status !== 'vendido';
                
                // Contabilidade para o Painel Admin
                stats.total++;
                if(item.status === 'negociacao') stats.leads++;
                if(isVencido) stats.alerts++;
                if(item.status === 'vendido') stats.vendas++;

                // Lógica de Abas
                if(currentTab === 'alertas' && !isVencido) return;
                if(currentTab === 'crm' && item.status === 'estoque') return;

                grid.innerHTML += `
                    <div class="bg-slate-900 border border-slate-800 p-6 rounded-[24px] relative group hover:border-sky-500/50 transition-all ${isVencido ? 'alert-vencido' : ''}">
                        <div class="flex justify-between items-start mb-4">
                            <span class="px-2 py-1 bg-slate-800 text-[9px] font-black rounded uppercase ${item.status === 'vendido' ? 'text-green-500' : 'text-sky-400'}">${item.status}</span>
                            <button onclick="excluir('${item.id}')" class="text-slate-700 hover:text-red-500 transition opacity-0 group-hover:opacity-100"><i class="fas fa-trash"></i></button>
                        </div>
                        
                        <h3 class="text-xl font-black text-white mb-1 uppercase italic">${item.carro}</h3>
                        <p class="text-2xl font-black text-sky-400 italic mb-4">R$ ${Number(item.preco).toLocaleString('pt-BR')}</p>
                        
                        <div class="space-y-2 pt-4 border-t border-slate-800/50">
                            <div class="flex justify-between text-[10px] font-bold">
                                <span class="text-slate-500 uppercase">Responsável:</span>
                                <span class="text-slate-300">${item.cliente}</span>
                            </div>
                            <div class="flex justify-between text-[10px] font-bold">
                                <span class="text-slate-500 uppercase">Status Alerta:</span>
                                <span class="${isVencido ? 'text-red-500' : 'text-slate-500'}">${isVencido ? 'EXPIRADO' : 'AGUARDANDO'}</span>
                            </div>
                        </div>
                    </div>`;
            });

            // Update Stats
            document.getElementById('stat-total').innerText = stats.total;
            document.getElementById('stat-leads').innerText = stats.leads;
            document.getElementById('stat-alerts').innerText = stats.alerts;
            document.getElementById('stat-vendas').innerText = stats.vendas;
        }

        window.changeTab = (tab) => {
            currentTab = tab;
            document.getElementById('page-title').innerText = tab === 'estoque' ? 'Estoque de Veículos' : (tab === 'crm' ? 'Fluxo de Leads' : 'Alertas e Pendências');
            
            // Botões Style
            ['btn-estoque', 'btn-crm', 'btn-alertas'].forEach(id => {
                document.getElementById(id).classList.remove('bg-sky-600', 'text-white');
                document.getElementById(id).classList.add('text-slate-400');
            });
            document.getElementById('btn-'+tab).classList.add('bg-sky-600', 'text-white');
            document.getElementById('btn-'+tab).classList.remove('text-slate-400');
            
            render();
        };

        onSnapshot(query(collection(db, "nexus_master"), orderBy("dataEntrada", "desc")), (snapshot) => {
            allData = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
            render();
        });
    </script>
</body>
</html>
